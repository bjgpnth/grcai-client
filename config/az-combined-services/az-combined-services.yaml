hosts:
  - name: grc-dev-tc-app-1-host
    type: vm
    address: grc-dev-tc-app-1.southindia.cloudapp.azure.com
  
    ssh:  # Add this section
      user: sadmin  # or whatever username your Azure VM uses
      port: 22  # optional, defaults to 22
      timeout: 5  # optional, defaults to 10
      # key_path: /root/.ssh/id_ed25519
      key_path: ~/.ssh/id_ed25519  # Will expand to /home/grcai/.ssh/id_ed25519 in container
      allow_agent: false

    # access:
    #   docker:
    #     use_local_socket: true  # keep for docker adapter/fallbacks if needed

    services:
      os:
        instances:
          - name: system
            runtime: host
            metrics: true
            logs:
              - /var/log/syslog
              - /var/log/auth.log

      nginx:
        instances:
          - name: nginx
            runtime: host
            conf_paths:
              - /etc/nginx/nginx.conf
            access_log: /var/log/nginx/access.log
            error_log: /var/log/nginx/error.log

      redis:
        instances:
          - name: redis
            runtime: host
            port: 6379
            logs:
              - /var/log/redis/redis-server.log

      postgres:
        instances:
          - name: postgres
            runtime: host
            database: postgres
            user: postgres
            password: "StrongP@ssword"
            port: 5432
            logs:
              - /var/log/postgresql/postgresql-14-main.log

      kafka:
        instances:
          - name: kafka
            runtime: host
            port: 29092
            kafka_home: /app/kafka/kafka_2.13-3.9.0
            bootstrap_servers: localhost:29092
            log_dirs:
              - /app/kafka/kafka_2.13-3.9.0/logs
              - /var/log/kafka/kraft-combined-logs  # adjust if different

      tomcat:
        instances:
          - name: tomcat10-be-01
            runtime: host
            port: 8083
            catalina_home: /app/app/tomcat10-be-01/
            logs:
              - /app/app/tomcat10-be-01/logs/catalina.out
          - name: tomcat-app-01
            runtime: host
            port: 8082
            catalina_home: /app/app/tomcat-app-01/
            logs:
              - /app/app/tomcat-app-01/logs/catalina.out
          - name: tomcat-app-01-app-api
            runtime: host
            port: 8081
            catalina_home: /app/app/tomcat-app-01-app-api/
            logs:
              - /app/app/tomcat-app-01-app-api/logs/catalina.out
          - name: tomcat-app-02
            runtime: host
            port: 8080
            catalina_home: /app/app/tomcat-app-02/
            logs:
              - /app/app/tomcat-app-02/logs/catalina.out

      nodejs:
        instances:
          - name: nodejs-app
            runtime: host
            app_dir: /var/www/app
            log_paths:
              - /var/www/app/app.log
              - /var/www/app/error.log

      docker:
        instances:
          - name: docker-host
            include_all_containers: true

  - name: grc-dev-tc-app-1-docker
    type: docker-host
    address: grc-dev-tc-app-1.southindia.cloudapp.azure.com

    ssh:  # ← ADD THIS SECTION
      user: sadmin
      port: 22
      key_path: ~/.ssh/id_ed25519
      allow_agent: false
    
    # access:
    #   docker:
    #     use_local_socket: true

    containers:
      - name: redis
      - name: kafka
      - name: mysql
      - name: node
      - name: postgres
      - name: jenkins
      - name: tomcat
      - name: nginx
      - name: mssql
      - name: node-app

    services:
      nginx:
        instances:
          - name: nginx
            runtime: docker
            container: nginx
            conf_paths:
              - /etc/nginx/nginx.conf
            access_log: /var/log/nginx/access.log
            error_log: /var/log/nginx/error.log

      redis:
        instances:
          - name: redis
            runtime: docker
            container: redis
            port: 6379

      postgres:
        instances:
          - name: postgres
            runtime: docker
            container: postgres
            database: postgres
            user: admin
            password: "password"
            port: 5432

      mysql:
        instances:
          - name: mysql
            runtime: docker
            container: mysql
            database: mysql
            user: root
            password: "<set-password>"
            port: 3306

      kafka:
        instances:
          - name: kafka
            runtime: docker
            container: kafka
            port: 9092
            mode: kraft
            data_dir: /tmp/kraft-combined-logs
            kafka_home: /opt/kafka
            bootstrap_servers: localhost:9092
            logs:
              - /opt/kafka/logs

      tomcat:
        instances:
          - name: tomcat
            runtime: docker
            container: tomcat
            catalina_home: /usr/local/tomcat
            logs:
              - /usr/local/tomcat/logs/catalina.out

      nodejs:
        instances:
          - name: nodejs-app
            runtime: docker
            container: node-app
            app_dir: /app
            log_paths:
              - /app/logs/app.log
              - /app/logs/error.log

      jenkins:
        instances:
          - name: jenkins
            runtime: docker
            container: jenkins

      # Docker adapter collects Docker daemon information from the host
      # Note: This adapter does NOT use the 'instances' structure - it reads
      # configuration directly from the top level of component_config
      docker:
        include_all_containers: true  # Collect info for all containers on the host

      # OS adapter collects system-level metrics and logs from the host
      # Note: This adapter does NOT use the 'instances' structure - it collects
      # OS metrics from all hosts in env_config["hosts"] and reads logs from
      # component_config directly
      os:
        runtime: host  # Indicates this runs on the host, not in a container
        metrics: true  # Enable OS metrics collection (CPU, memory, disk)
        logs:
          - /var/log/syslog
          - /var/log/auth.log
      
      mssql:
        instances:
          - name: mssql
            runtime: docker
            container: mssql
            port: 1433  # ← Container port, not host port
            database: master
            user: sa
            password: "StrongP@ssword!"
            trust_server_certificate: true

metadata:
  owner: azure-lab
  description: Azure VM Docker-based services and Azure VM host-level services